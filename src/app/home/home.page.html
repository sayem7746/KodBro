<ion-header [translucent]="true">
  <ion-toolbar class="app-text">
    <ion-buttons slot="start">
      <a routerLink="/home" class="flex items-center">
        <img src="assets/kodbro-logo.png" alt="KodBro" class="h-8 object-contain" />
      </a>
    </ion-buttons>
    <ion-title>Welcome</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-cream app-text">
  <ion-header collapse="condense">
    <ion-toolbar class="app-text">
      <ion-buttons slot="start">
        <img src="assets/kodbro-logo.png" alt="KodBro" class="h-8 object-contain" />
      </ion-buttons>
      <ion-title size="large">Welcome</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="home-inner flex flex-col px-4 py-4 w-full max-w-2xl mx-auto">
    <!-- Terminal panel -->
    <div class="terminal-panel flex flex-col rounded-xl overflow-hidden shadow-lg border border-navy/20 flex-1 min-h-[320px]">
      <div class="terminal-header flex items-center gap-2 px-3 py-2">
        <span class="w-3 h-3 rounded-full bg-red/90"></span>
        <span class="w-3 h-3 rounded-full bg-steel/80"></span>
        <span class="w-3 h-3 rounded-full bg-navy/80"></span>
        <span class="text-[#f8f5ed] text-xs font-medium ml-2">Terminal</span>
        @if (terminal.connection.connected && terminal.connection.isRemoteApi) {
          <span class="text-[#85a9cb] text-xs ml-1">(Remote API)</span>
        }
      </div>

      <!-- Terminal server connection -->
      <div class="ssh-bar px-3 py-2 flex flex-wrap items-center gap-2 bg-navy/5 border-b border-navy/10">
        <input
          type="text"
          [(ngModel)]="serverUrl"
          placeholder="https://your-api.vercel.app or ws://localhost:8765/ws"
          class="terminal-input server-url-input"
        />
        @if (terminal.connection.connected) {
          <button
            type="button"
            (click)="disconnect()"
            class="terminal-btn disconnect"
          >
            Disconnect
          </button>
        } @else {
          <button
            type="button"
            (click)="connect()"
            class="terminal-btn connect"
          >
            Connect
          </button>
        }
      </div>

      <div
        class="terminal-output flex-1 overflow-y-auto p-3 font-mono text-sm"
        #outputEl
      >
        @for (line of terminal.lines; track $index) {
          <div
            class="terminal-line"
            [class.cmd]="line.type === 'command'"
            [class.out]="line.type === 'output'"
            [class.err]="line.type === 'error'"
          >
            {{ line.text }}
          </div>
        }
        <div class="terminal-input-line flex items-baseline gap-1 flex-wrap">
          @if (terminal.connection.connected) {
            <span class="terminal-prompt text-amber-600 shrink-0">$ </span>
          } @else {
            <span class="terminal-prompt text-amber-600 shrink-0">{{ terminal.prompt }}</span>
          }
          <input
            type="text"
            [(ngModel)]="commandInput"
            (keydown)="onCommandKeydown($event)"
            (keydown.arrowUp)="$event.preventDefault(); setHistoryPrev()"
            (keydown.arrowDown)="$event.preventDefault(); setHistoryNext()"
            class="terminal-cmd-input"
            [placeholder]="terminal.connection.connected ? 'Type a command...' : 'Connect to run commands'"
            autocomplete="off"
            autocapitalize="off"
            spellcheck="false"
          />
        </div>
      </div>
    </div>
  </div>
</ion-content>
