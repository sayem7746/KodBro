<ion-header [translucent]="true">
  <ion-toolbar class="app-text">
    <ion-buttons slot="start">
      <a routerLink="/home" class="flex items-center">
        <img src="assets/kodbro-logo.png" alt="KodBro" class="h-8 object-contain" />
      </a>
    </ion-buttons>
    <ion-title>My Apps</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-cream app-text">
  <div class="history-inner px-4 py-4 max-w-2xl mx-auto">
    <h2 class="text-lg font-semibold mb-4">App history</h2>
    <p class="text-sm opacity-90 mb-6">
      Apps you've created with KodBro.
    </p>

    @if (loading) {
      <ion-spinner name="crescent"></ion-spinner>
    } @else if (error) {
      <ion-note color="danger" class="block">{{ error }}</ion-note>
    } @else if (jobs.length === 0) {
      <p class="text-sm opacity-80">No apps yet. Build one from the home page with the agent.</p>
    } @else {
      <ion-list lines="full">
        @for (job of jobs; track job.id) {
          <ion-item>
            <ion-label>
              <h3 class="font-semibold">{{ job.app_name }}</h3>
              <p class="text-sm opacity-80 mt-0.5">{{ formatDate(job.created_at) }}</p>
              @if (job.repo_url) {
                <p class="text-xs mt-1.5 flex flex-wrap items-center gap-x-2 gap-y-0.5">
                  <a [href]="job.repo_url" target="_blank" rel="noopener" class="text-primary underline">
                    {{ repoDisplayUrl(job.repo_url) }}
                  </a>
                  @if (job.deploy_url) {
                    <span class="opacity-60">Â·</span>
                    <a [href]="job.deploy_url" target="_blank" rel="noopener" class="text-primary underline">Deploy</a>
                  }
                </p>
              }
            </ion-label>
            <div slot="end" class="flex items-center gap-2">
              <ion-badge [color]="statusColor(job.status)">
                {{ job.status }}
              </ion-badge>
              <ion-button
                fill="clear"
                color="danger"
                size="small"
                [disabled]="deletingId === job.id"
                (click)="deleteJob(job)"
                aria-label="Delete"
              >
                @if (deletingId === job.id) {
                  <ion-spinner name="crescent"></ion-spinner>
                } @else {
                  <ion-icon name="trash-outline"></ion-icon>
                }
              </ion-button>
            </div>
          </ion-item>
        }
      </ion-list>
    }
  </div>
</ion-content>
